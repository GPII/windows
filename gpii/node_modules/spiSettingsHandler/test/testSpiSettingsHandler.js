var spi = require("../src/SpiSettingsHandler.js");
var fluid = require("universal");
var gpii = fluid.registerNamespace("gpii");
var windows = fluid.registerNamespace("gpii.windows");

var testPayloads = ["testFilterKeys", "testLogFont", "testMouse", "testMouseClickLock"];

exports.test = function () {
    for (var i in testPayloads) {
        var name = testPayloads[i];
        var payload = require(__dirname + "/" + name);
        console.log(name);
        
        var expectedSettings = payload.settings;
        var oldSettings = windows.spiSettingsHandler.get(payload);
        var newSettings = windows.spiSettingsHandler.set(payload);
        
        for (var setting in expectedSettings) {
            var expected = setting === "dwFlags" ? windows.combineFlags(expectedSettings[setting]) : expectedSettings[setting];
            
            if (expected != newSettings[setting].newValue) {
                console.log("\n\n" + name + " error - expected " + expectedSettings[setting] + " but found " + newSettings[setting].newValue + "\n\n");
            }
        }
        
        payload.settings = oldSettings;
        windows.spiSettingsHandler.set(payload);
    }
    
    console.log("END");
};
