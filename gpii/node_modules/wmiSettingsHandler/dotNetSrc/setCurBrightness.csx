/*
 * Windows Display Settings Handler
 *
 * Copyright 2016 Raising the Floor - US
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

using System;
using System.Threading.Tasks;
using System.Management;

public class Startup {
    public async Task<object> Invoke(object input) {
        // Define scope (namespace)
        ManagementScope s = new ManagementScope("root\\WMI");
        // Define query
        SelectQuery q = new SelectQuery("WmiMonitorBrightnessMethods");

        ManagementObjectSearcher mos = new ManagementObjectSearcher(s, q);

        ManagementObjectCollection moc = mos.Get();

        object res = null;

        foreach (ManagementObject mObj in moc) {
            res = mObj.InvokeMethod("WmiSetBrightness", new Object[] { UInt32.MaxValue, input }) as uint?;
            break;
        }

        if (res == null) {
            return  0;
        } else {
            return res;
        }
    }
}