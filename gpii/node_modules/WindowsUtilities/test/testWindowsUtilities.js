/*
 * Windows Registry Settings Handler
 *
 * Copyright 2015 Raising the Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * The research leading to these results has received funding from the European Union's
 * Seventh Framework Programme (FP7/2007-2013)
 * under grant agreement no. 289016.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("universal");

var jqUnit = fluid.require("jqUnit");
var gpii = fluid.registerNamespace("gpii");
var shelljs = require("shelljs");

fluid.registerNamespace("gpii.windows.tests.windowsUtilities");

require("../../../../index.js");

jqUnit.module("Windows Utitilies");

jqUnit.test("Testing Killing Processes", function () {
    jqUnit.expect(3);

    var exeName = "putty-0FEF1314.exe";
    var tasklistCmd = "tasklist /fi \"STATUS eq RUNNING\" /FI \"IMAGENAME eq "
      + exeName + "\"";

    var checkForTask = function() {
        var result = shelljs.exec(tasklistCmd);
        if (result.output.indexOf(exeName) >= 0) {
            return true;
        }
        else {
            return false;
        }
    }
    jqUnit.assertDeepEq( "We've haven't started it yet.", false, checkForTask());
    shelljs.exec(".\\gpii\\node_modules\\WindowsUtilities\\test\\" + exeName, {
        async: true
    });
    jqUnit.assertDeepEq("We just started the new putty.", true, checkForTask());
    gpii.windows.killProcessByName(exeName);
    jqUnit.assertDeepEq("Just killed our putty with killProcessByName.", false, checkForTask());
});
