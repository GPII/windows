/*
 * Monitor brightness support for Windows
 *
 * Copyright 2016 Raising the Floor - US
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */
"use strict";

var fluid = require("universal"),
    path = require("path"),
    edge = require("edge");

var windows = fluid.registerNamespace("gpii.windows");

fluid.registerNamespace("gpii.windows.display");

var isBrightnessSupported = edge.func({
    source: path.join(__dirname, "..\\dotNetSrc\\isBrightnessSupported.csx"),
    references: ["System.Management.dll"]
});

windows.wmi.isBrightnessSupported = function () {
    try {
        var res = isBrightnessSupported(null, true);
        return res;
    } catch(error) {
        if (error.ErrorCode === "NotSupported") {
            return false;
        } else {
            fluid.fail("windows.wmi.isBrightnessSupported: Unknown error");
        }
    }
};

var getBrightness = edge.func({
    source: path.join(__dirname, "..\\dotNetSrc\\getCurBrightness.csx"),
    references: ["System.Management.dll"]
});

windows.wmi.getScreenBrightness = function () {
    var result;

    try {
        result = getBrightness(null, true);
    } catch(error) {
        if (error.ErrorCode === "NotSupported") {
            fluid.fail("windows.wmi.setBrightness: Is not supported in this environmment.");
        } else {
            fluid.fail("windows.wmi.setBrightness: Failed.");
        }
    }

    return result;
};

var setBrightness = edge.func({
    source: path.join(__dirname, "..\\dotNetSrc\\setCurBrightness.csx"),
    references: ["System.Management.dll"]
});

windows.wmi.setScreenBrightness = function (value) {
    var result;

    try {
        result = setBrightness(value, true);
    } catch(error) {
        if (error.ErrorCode === "NotSupported") {
            fluid.fail("windows.wmi.setBrightness: Is not supported in this environmment.");
        } else {
            fluid.fail("windows.wmi.setBrightness: Failed with error: '" + error.message + "'");
        }
    }

    return result;
};
