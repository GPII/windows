/*
 * Windows Display Settings Handler Tests
 *
 * Copyright 2015 Raising the Floor - International
 * Copyright 2016 Raising the Floor - US
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * The research leading to these results has received funding from the European Union's
 * Seventh Framework Programme (FP7/2007-2013)
 * under grant agreement no. 289016.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("universal");

var jqUnit = fluid.require("node-jqUnit");
var gpii = fluid.registerNamespace("gpii");

require("../../../../index.js");

fluid.registerNamespace("gpii.windows.tests.windowsUtilities");

// These tests are commented out as will change PC screen resolution
jqUnit.test("Testing GetScreenResolution", function () {
    // Test do not get the error return
    jqUnit.expect(1);
    var errorRes = { width: 0, height: 0};
    var screenRes = gpii.windows.display.getScreenResolution();
    jqUnit.assertDeepNeq("Unexpected screen resolution", errorRes, screenRes);
});


// WARNING!! - will change display resolution and potentially mess up icon layouts
jqUnit.test("Testing changing screen resolution ", function () {
    var oldRes = gpii.windows.display.getScreenResolution();

    // Test can change resolution
    // Not such a good unit test as depends on available modes
    jqUnit.expect(2);
    var targetRes = { width: 800, height: 600 };
    jqUnit.assertTrue("We can call to setScreenResolution, it returns 'true'", gpii.windows.display.setScreenResolution(targetRes));
    var newRes = gpii.windows.display.getScreenResolution();
    jqUnit.assertDeepEq("New resolution is set", targetRes, newRes);

    // Restore old resolution
    jqUnit.expect(2);
    jqUnit.assertTrue("Error resetting old resolution", gpii.windows.display.setScreenResolution(oldRes));
    var restoredRes = gpii.windows.display.getScreenResolution();
    jqUnit.assertDeepEq("Old resolutions does not appear to be restored", oldRes, restoredRes);

    // test can't change to invalid resolution
    jqUnit.expect(2);
    var badRes = { width: 123, height: 123 };
    jqUnit.assertFalse("Expected setting invalid resolution to fail", gpii.windows.display.setScreenResolution(badRes));
    var newRes2 = gpii.windows.display.getScreenResolution();
    jqUnit.assertDeepEq("Reported resolution should not have changed", oldRes, newRes2);
});
