/*
 * Tests for the nativeSettingsHandler
 *
 * Copyright 2018 Raising the Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("gpii-universal");

var jqUnit = fluid.require("node-jqunit");
var gpii = fluid.registerNamespace("gpii");

fluid.require("%gpii-windows");

require("../src/nativeSettingsHandler");

fluid.registerNamespace("gpii.tests.windows.nativeSettingsHandler");

var teardowns = [];
jqUnit.module("gpii.tests.windows.nativeSettingsHandler", {
    setup: function () {
    },
    teardown: function () {
        while (teardowns.length) {
            teardowns.pop()();
        }
    }
});

gpii.tests.windows.nativeSettingsHandler.apiTest = {
    init: {
        "settings": {
            "DoubleClickTimeConfig": {
                "value": 500
            }
        },
        "options": {
            "functionName": "DoubleClickTime"
        }
    },
    set: {
        payload: {
            "com.microsoft.windows.mouseSettings": [{
                "settings": {
                    "DoubleClickTimeConfig": {
                        "value": 600
                    }
                },
                "options": {
                    "functionName": "DoubleClickTime"
                }
            }]
        },
        expectedResult: {
            "com.microsoft.windows.mouseSettings": [{
                "settings": {
                    "DoubleClickTimeConfig": {
                        "oldValue": {
                            "value": 500
                        },
                        "newValue": {
                            "value": 600
                        }
                    }
                }
            }]
        }
    },
    get: {
        payload: {
            "com.microsoft.windows.mouseSettings": [{
                "settings": {
                    "DoubleClickTimeConfig": {}
                },
                "options": {
                    "functionName": "DoubleClickTime"
                }
            }]
        },
        expectedResult: {
            "com.microsoft.windows.mouseSettings": [{
                "settings": {
                    "DoubleClickTimeConfig": {
                        "value": 500
                    }
                }
            }]
        }
    }
};

jqUnit.test("Testing nativeSettingsHandler API (get and set functions)", function () {
    jqUnit.expect(2);

    // Set to initial values:
    gpii.windows.nativeSettingsHandler.setImpl(gpii.tests.windows.nativeSettingsHandler.apiTest.init);
    // First we test the get functionality
    var result = gpii.windows.nativeSettingsHandler.get(gpii.tests.windows.nativeSettingsHandler.apiTest.get.payload);
    // Check results
    jqUnit.assertDeepEq("Checking return payload of get", gpii.tests.windows.nativeSettingsHandler.apiTest.get.expectedResult, gpii.resolveSync(result));

    // Test set functionality
    var result2 = gpii.windows.nativeSettingsHandler.set(gpii.tests.windows.nativeSettingsHandler.apiTest.set.payload);
    // Check results
    jqUnit.assertDeepEq("Checking return payload of set", gpii.tests.windows.nativeSettingsHandler.apiTest.set.expectedResult, gpii.resolveSync(result2));
});

gpii.tests.windows.nativeSettingsHandler.volumeApiTest = {
    init: {
        "settings": {
            "Volume": {
                "value": 0.5
            }
        },
        "options": {
            "functionName": "Volume"
        }
    },
    set: {
        payload: {
            "com.microsoft.windows.volume": [{
                "settings": {
                    "Volume": {
                        "value": 0.7
                    }
                },
                "options": {
                    "functionName": "Volume"
                }
            }]
        },
        expectedResult: {
            "com.microsoft.windows.volume": [{
                "settings": {
                    "Volume": {
                        "oldValue": {
                            "value": 0.5
                        },
                        "newValue": {
                            "value": 0.7
                        }
                    }
                }
            }]
        }
    },
    get: {
        payload: {
            "com.microsoft.windows.volume": [{
                "settings": {
                    "Volume": {}
                },
                "options": {
                    "functionName": "Volume"
                }
            }]
        },
        expectedResult: {
            "com.microsoft.windows.volume": [{
                "settings": {
                    "Volume": {
                        "value": 0.5
                    }
                }
            }]
        }
    }
};

jqUnit.test("Testing nativeSettingsHandler volume API (get and set functions)", function () {
    jqUnit.expect(2);

    // Set to initial values:
    gpii.windows.nativeSettingsHandler.setImpl(gpii.tests.windows.nativeSettingsHandler.volumeApiTest.init);
    // First we test the get functionality
    var result = gpii.windows.nativeSettingsHandler.get(gpii.tests.windows.nativeSettingsHandler.volumeApiTest.get.payload);
    // Check results
    jqUnit.assertDeepEq("Checking return payload of get", gpii.tests.windows.nativeSettingsHandler.volumeApiTest.get.expectedResult, gpii.resolveSync(result));

    // Test set functionality
    var result2 = gpii.windows.nativeSettingsHandler.set(gpii.tests.windows.nativeSettingsHandler.volumeApiTest.set.payload);
    // Check results
    jqUnit.assertDeepEq("Checking return payload of set", gpii.tests.windows.nativeSettingsHandler.volumeApiTest.set.expectedResult, gpii.resolveSync(result2));
});
