/*
 * Handles requests from Windows Service.
 *
 * Copyright 2018 Raising the Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * The R&D leading to these results received funding from the
 * Department of Education - Grant H421A150005 (GPII-APCP). However,
 * these results do not necessarily represent the policy of the
 * Department of Education, and you should not assume endorsement by the
 * Federal Government.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("gpii-universal");

var gpii = fluid.registerNamespace("gpii");
fluid.registerNamespace("gpii.windows.service.serviceHandler");

// Handles requests from the service.
fluid.defaults("gpii.windows.service.requestHandler", {
    gradeNames: ["fluid.component" ],
    invokers: {
        handleRequest: {
            funcName: "gpii.windows.service.echo",
            args: [ "{that}", "{arguments}.0" ]
        },
        echo: {
            funcName: "gpii.windows.service.echo",
            args: [ "{that}", "{arguments}.0" ]
        }
    }
});

/**
 * Handle a request from the service, by calling the relevant invoker of gpii.windows.service.requestHandler.
 *
 * @param {Component} that The gpii.serviceHandler instance.
 * @param {Object} request The request. It should at least contain "name" which is the name of the request.
 */
gpii.windows.service.handleRequest = function (that, request) {
    fluid.log("Service: request", request);
    if (that.requestHandler.options.invokers.hasOwnProperty(request.action)) {
        return that.requestHandler[request.action](request.data);
    }
};


/**
 * Example request.
 * @param {Component} that The gpii.serviceHandler instance.
 * @param {object} request The request.
 * @return {object} an object containing the request.
 */
gpii.windows.service.echo = function (that, request) {
    return {
        hello: "Hello from gpii client",
        youSaid: request
    };
};
