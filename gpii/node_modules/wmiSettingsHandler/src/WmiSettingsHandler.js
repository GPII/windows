/*
 * WmiSetttingsHandler
 *
 * Copyright 2018 Raising the Floor - US
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("gpii-universal");

var gpii = fluid.registerNamespace("gpii");
var windows = fluid.registerNamespace("gpii.windows");

fluid.registerNamespace("gpii.windows.wmi");
fluid.registerNamespace("gpii.windows.wmiSettingsHandler");

require("./brightness.js");

gpii.windows.wmi.setImpl = function (payload) {
    var results = {};

    var targetBright = payload.settings["screen-brightness"];
    if (targetBright) {
        var oldBright = windows.wmi.getScreenBrightness();
        windows.wmi.setScreenBrightness(targetBright);
        results["screen-brightness"] = { oldValue: oldBright, newValue: targetBright };
    }

    fluid.log("WmiSettingsHandler: Settings handler SET returning results: ", results);
    return results;
};

gpii.windows.wmiSettingsHandler.set = function (payload) {
    return gpii.settingsHandlers.invokeSettingsHandler(gpii.windows.wmi.setImpl, payload);
};

gpii.windows.wmi.getImpl = function () {
    var curBright = windows.wmi.getScreenBrightness();

    var results = {
        "screen-brightness": curBright
    };

    return results;
};

gpii.windows.wmiSettingsHandler.get = function (payload) {
    return gpii.settingsHandlers.invokeSettingsHandler(gpii.windows.wmi.getImpl, payload);
};
