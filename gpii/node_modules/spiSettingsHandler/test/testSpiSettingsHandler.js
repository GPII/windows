var spi = require("../src/SpiSettingsHandler.js");
var fluid = require("universal");
var gpii = fluid.registerNamespace("gpii");
var windows = fluid.registerNamespace("gpii.windows");

var testPayloads = ["testFilterKeys", "testLogFont", "testMouse", "testMouseClickLock"];

exports.test = function () {
    for (var i in testPayloads) {
        var name = testPayloads[i];
        var payload = require(__dirname + "/" + name);
        console.log("\n\n", name);
        
        var expectedSettings = payload.settings;
        var oldSettings = windows.spiSettingsHandler.get(payload);
        var newSettings = windows.spiSettingsHandler.set(payload);
        
        for (var currentSetting in expectedSettings) {
            var expected = expectedSettings[currentSetting].value;
            
            if (expected != newSettings[currentSetting].newValue) {
                console.error("\n", name, "error - expected", expectedSettings[currentSetting], "but found", newSettings[currentSetting].newValue, "\n");
            }
            
            payload.settings[currentSetting].value = oldSettings[currentSetting];
        }
        
        windows.spiSettingsHandler.set(payload);
    }
    
    console.log("END");
};
