/*
 * Windows Utilities Tests
 *
 * Copyright 2018 Raising the Floor - International
 *
 * Licensed under the New BSD license. You may not use this file except in
 * compliance with this License.
 *
 * You may obtain a copy of the License at
 * https://github.com/GPII/universal/blob/master/LICENSE.txt
 */

"use strict";

var fluid = require("gpii-universal"),
    jqUnit = fluid.require("node-jqunit");

require("../WindowsUtilities.js");

var windows = fluid.registerNamespace("gpii.windows");

jqUnit.test("Testing 'windows.resolveFlags' function with SpiFlags", function () {
    jqUnit.expect(1);

    var expected = windows.API_constants.SpiFlags.SPIF_UPDATEINIFILE | windows.API_constants.SpiFlags.SPIF_SENDCHANGE;
    var fWinIni = windows.resolveFlags("SPIF_UPDATEINIFILE | SPIF_SENDCHANGE", windows.API_constants.SpiFlags);

    jqUnit.assertDeepEq("Checking return value", expected, fWinIni);
});

jqUnit.test("Testing 'windows.resolveFlags' function with 'virtualKeyCodes'", function () {
    jqUnit.expect(2);

    var expected = windows.API_constants.virtualKeyCodes.VK_CONTROL & windows.API_constants.virtualKeyCodes.VK_PAGEUP;
    var fResult = windows.resolveFlags("VK_CONTROL & VK_PAGEUP", windows.API_constants.virtualKeyCodes);

    jqUnit.assertDeepEq("Checking return value", expected, fResult);

    var flags = "VK_CONTROL & VK_PAGEUP & VK_RWIN & VK_PAGEDOWN & VK_F7";
    expected =
        windows.API_constants.virtualKeyCodes.VK_CONTROL &
        windows.API_constants.virtualKeyCodes.VK_PAGEUP &
        windows.API_constants.virtualKeyCodes.VK_RWIN &
        windows.API_constants.virtualKeyCodes.VK_PAGEDOWN &
        windows.API_constants.virtualKeyCodes.VK_F7;

    fResult = windows.resolveFlags(flags, windows.API_constants.virtualKeyCodes);

    jqUnit.assertDeepEq("Checking return value", expected, fResult);
});

jqUnit.test("Testing 'windows.resolveFlags' function with array of flags", function () {
    jqUnit.expect(1);

    var expected =
        windows.API_constants.virtualKeyCodes.VK_F1 |
        windows.API_constants.virtualKeyCodes.VK_F2 |
        windows.API_constants.virtualKeyCodes.VK_F3 |
        windows.API_constants.virtualKeyCodes.VK_F8 |
        windows.API_constants.virtualKeyCodes.VK_ESCAPE;
    var arrayValues = ["VK_F1", "VK_F2", "VK_F3", "VK_F8", "VK_ESCAPE"];

    var fResult = windows.resolveFlags(arrayValues, windows.API_constants.virtualKeyCodes);

    jqUnit.assertDeepEq("Checking return value", expected, fResult);
});

jqUnit.test("Testing 'windows.translateLastError' function", function () {
    jqUnit.expect(5);

    var msgMaps = [
        [1, "Incorrect function.\r\n"],
        [3, "The system cannot find the path specified.\r\n"],
        [5, "Access is denied.\r\n"],
        [10, "The environment is incorrect.\r\n"],
        [15, "The system cannot find the drive specified.\r\n"]
    ];

    fluid.each(msgMaps, function (msgMap) {
        var msgRes = windows.translateLastError(msgMap[0]);
        jqUnit.assertDeepEq("Checking expected message with error translation", msgMap[1], msgRes);
    });
});
